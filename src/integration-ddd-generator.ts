/**
 * Integra√ß√£o do Gerador DDD a partir de Interfaces TypeScript
 * com o sistema principal @purecore/apify
 */

import { generateDDDFromInterface } from './generators/ddd-from-interfaces';
import { autoGenerateDDDFromZodSchemas } from './auto-generator-ddd';

// Interface para definir op√ß√µes de gera√ß√£o combinada
export interface CombinedGenerationOptions {
  useZodSchemas?: boolean;
  useInterfaceSchemas?: boolean;
  modulesPath?: string;
  domainPath?: string;
  force?: boolean;
  verbose?: boolean;
  dryRun?: boolean;
  boundedContext?: string;
}

/**
 * Fun√ß√£o para gerar m√≥dulos DDD combinando diferentes abordagens:
 * - Zod schemas (existente)
 * - Interfaces TypeScript (nova funcionalidade)
 */
export async function generateCombinedDDD(
  interfaces?: Record<string, string>, // nome => c√≥digo da interface
  options: CombinedGenerationOptions = {}
): Promise<void> {
  console.log('üöÄ Iniciando gera√ß√£o DDD combinada...');
  
  const {
    useZodSchemas = true,
    useInterfaceSchemas = true,
    modulesPath = 'src/modules',
    ...restOptions
  } = options;

  // Gerar a partir de interfaces TypeScript se solicitado
  if (useInterfaceSchemas && interfaces) {
    console.log('üìù Gerando a partir de interfaces TypeScript...');
    
    for (const [name, interfaceCode] of Object.entries(interfaces)) {
      console.log(`   Gerando m√≥dulo para: ${name}`);
      
      try {
        await generateDDDFromInterface(interfaceCode, {
          modulesPath,
          ...restOptions
        });
        
        console.log(`   ‚úÖ M√≥dulo ${name} gerado com sucesso`);
      } catch (error) {
        console.error(`   ‚ùå Erro ao gerar m√≥dulo ${name}:`, error);
      }
    }
  }

  // Gerar a partir de Zod schemas se solicitado
  if (useZodSchemas) {
    console.log('üîç Gerando a partir de schemas Zod existentes...');
    
    try {
      await autoGenerateDDDFromZodSchemas({
        modulesPath,
        ...restOptions
      });
      
      console.log('‚úÖ Gera√ß√£o a partir de Zod schemas conclu√≠da');
    } catch (error) {
      console.error('‚ùå Erro na gera√ß√£o a partir de Zod schemas:', error);
    }
  }

  console.log('üéâ Gera√ß√£o DDD combinada conclu√≠da!');
}

/**
 * Exemplo de uso combinado
 */
export async function runCombinedExample(): Promise<void> {
  // Definir interfaces TypeScript para gera√ß√£o
  const interfaces: Record<string, string> = {
    User: `
interface User {
  id: string;
  name: string;
  email: string;
  age: number;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}`,
    Product: `
interface Product {
  id: string;
  name: string;
  description: string;
  price: number;
  category: string;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}`
  };

  // Executar gera√ß√£o combinada
  await generateCombinedDDD(interfaces, {
    modulesPath: 'src/modules',
    verbose: true,
    force: true
  });
}

// Exportar para uso direto
export {
  generateDDDFromInterface,
  DDDFromInterfacesGenerator
} from './generators/ddd-from-interfaces';

// Exportar tipos √∫teis
export type {
  DDDGenerationOptions
} from './generators/ddd-from-interfaces';

console.log('‚úÖ M√≥dulo de integra√ß√£o DDD carregado com sucesso');