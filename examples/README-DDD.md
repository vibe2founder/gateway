# ğŸš€ Exemplo AutoGeneratorDDD

Este diretÃ³rio contÃ©m exemplos completos de como usar o **AutoGeneratorDDD** para gerar arquitetura **Domain-Driven Design (DDD)** baseada em schemas Zod.

## ğŸ“ Arquivos

- **`user.schema.ts`** - Schema Zod completo para entidade User
- **`test-ddd-generator.ts`** - Exemplos de uso do AutoGeneratorDDD
- **`README-DDD.md`** - Esta documentaÃ§Ã£o

## ğŸ—ï¸ O que o DDD Generator Cria

Para cada entidade definida em um schema Zod, o generator cria **15+ arquivos** organizados em **4 camadas DDD**:

### 1. Domain Layer (ğŸ›ï¸ Camada de DomÃ­nio)
```
domain/
â”œâ”€â”€ entities/user.entity.ts          # Entidade pura de domÃ­nio
â”œâ”€â”€ value-objects/email.vo.ts        # Value Objects (Email, Password, etc.)
â”œâ”€â”€ aggregates/userAggregate.ts      # Aggregate Root
â”œâ”€â”€ events/user.events.ts            # Domain Events
â”œâ”€â”€ services/user.domain-service.ts  # Domain Services
â””â”€â”€ repositories/iuser.repository.ts # Repository Interface
```

### 2. Application Layer (ğŸ“± Camada de AplicaÃ§Ã£o)
```
application/
â”œâ”€â”€ commands/user.commands.ts        # CQRS Commands
â”œâ”€â”€ queries/user.queries.ts          # CQRS Queries
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ user.command-handlers.ts     # Command Handlers
â”‚   â””â”€â”€ user.query-handlers.ts       # Query Handlers
â”œâ”€â”€ dtos/user.dto.ts                 # Data Transfer Objects
â””â”€â”€ services/user.app-service.ts     # Application Service
```

### 3. Infrastructure Layer (ğŸ”§ Camada de Infraestrutura)
```
infrastructure/
â”œâ”€â”€ repositories/user.repository.ts   # Repository Implementation
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ user.schema.ts               # Database Schema
â”‚   â””â”€â”€ context.ts                   # Database Context
â”œâ”€â”€ external-services/
â”‚   â””â”€â”€ user.external-service.ts     # External API Integration
â””â”€â”€ config/database.config.ts        # Infrastructure Config
```

### 4. Presentation Layer (ğŸŒ Camada de ApresentaÃ§Ã£o)
```
presentation/
â”œâ”€â”€ controllers/user.controller.ts    # REST Controller
â”œâ”€â”€ routes/user.routes.ts            # Route Definitions
â””â”€â”€ middlewares/user.middleware.ts   # Custom Middlewares
```

### Cross-Cutting Concerns (ğŸ¯ PreocupaÃ§Ãµes Transversais)
```
tests/user.test.ts                    # Comprehensive Tests
shared/constants.ts                   # Shared Constants
index.ts                             # Module Exports
```

## ğŸš€ Como Testar

### 1. Executar Exemplo Simples

```bash
# No diretÃ³rio raiz do projeto
bun run examples/test-ddd-generator.ts
```

### 2. Gerar Arquitetura Real (nÃ£o dry-run)

Edite o arquivo `examples/test-ddd-generator.ts` e mude `dryRun: true` para `dryRun: false`:

```typescript
await autoGenerateDDDFromZodSchemas({
  modulesPath: 'src/modules',
  domainPath: 'src/domain',
  boundedContext: 'user-management',
  verbose: true,
  force: false,
  dryRun: false // <-- Mude para false
});
```

### 3. Ver Resultado

ApÃ³s a execuÃ§Ã£o, vocÃª verÃ¡ uma estrutura como:

```
src/modules/user/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/user.entity.ts
â”‚   â”œâ”€â”€ aggregates/userAggregate.aggregate.ts
â”‚   â”œâ”€â”€ events/user.events.ts
â”‚   â”œâ”€â”€ services/user.domain-service.ts
â”‚   â””â”€â”€ repositories/iuser.repository.ts
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ commands/user.commands.ts
â”‚   â”œâ”€â”€ queries/user.queries.ts
â”‚   â”œâ”€â”€ handlers/user.command-handlers.ts
â”‚   â”œâ”€â”€ handlers/user.query-handlers.ts
â”‚   â”œâ”€â”€ dtos/user.dto.ts
â”‚   â””â”€â”€ services/user.app-service.ts
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ repositories/user.repository.ts
â”‚   â”œâ”€â”€ database/user.schema.ts
â”‚   â”œâ”€â”€ external-services/user.external-service.ts
â”‚   â””â”€â”€ config/database.config.ts
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ controllers/user.controller.ts
â”‚   â”œâ”€â”€ routes/user.routes.ts
â”‚   â””â”€â”€ middlewares/user.middleware.ts
â”œâ”€â”€ tests/user.test.ts
â”œâ”€â”€ shared/constants.ts
â””â”€â”€ index.ts
```

## ğŸ“‹ Entrada: 1 interface TS ou JSON-Schema

O gerador aceita **trÃªs formas de entrada**:

### 1. Interface Ãºnica TypeScript (DDDSchemaInput)

Uma Ãºnica interface compatÃ­vel com JSON-Schema â€” sem depender de Zod para entrada:

```typescript
import type { DDDSchemaInput } from "../src/ddd-schema-types.js";
import { generateFromDDDSchema } from "../src/auto-generator-ddd.js";

const orderSchema: DDDSchemaInput = {
  name: "Order",
  title: "Order",
  properties: {
    id: { type: "string", format: "uuid" },
    total: { type: "number", minimum: 0 },
    status: { type: "string", enum: ["pending", "confirmed"], default: "pending" },
    createdAt: { type: "date" },
    updatedAt: { type: "date" },
  },
  required: ["id", "total", "status", "createdAt", "updatedAt"],
  primaryKey: "id",
};

await generateFromDDDSchema(orderSchema, { outputPath: "src/modules/order" });
```

Execute: `npm run example:ddd:interface` (usa `examples/order.ddd.ts`).

### 2. JSON-Schema (.schema.json)

Coloque um arquivo `.schema.json` na pasta de mÃ³dulos (ex.: `src/modules/product.schema.json`). O gerador converte para DDDSchemaInput e gera a estrutura DDD. Exemplo em `examples/product.schema.json`.

### 3. Schema Zod (.schema.ts)

O arquivo `user.schema.ts` demonstra um schema completo com:

- **Value Objects**: `EmailSchema`, `PasswordSchema`, `NameSchema`
- **Enums**: `UserRoleSchema`, `UserStatusSchema`
- **Entidade Completa**: `UserSchema` com todos os campos
- **Schemas Especializados**: `CreateUserSchema`, `UpdateUserSchema`, `LoginUserSchema`
- **ValidaÃ§Ãµes**: Regras de negÃ³cio no schema Zod
- **Tipos TypeScript**: Inferidos automaticamente

## ğŸ¯ Funcionalidades Demonstradas

### CQRS Pattern
```typescript
// Commands (escrita)
CreateUserCommand, UpdateUserCommand, DeleteUserCommand

// Queries (leitura)
GetUserByIdQuery, GetAllUsersQuery, SearchUsersQuery

// Handlers separados
UserCommandHandlers, UserQueryHandlers
```

### Domain-Driven Design
```typescript
// Entidade de domÃ­nio pura
export class User {
  // Regra de negÃ³cio na entidade
  public validate(): boolean {
    // ValidaÃ§Ãµes de domÃ­nio
    return true;
  }
}

// Aggregate Root
export class UserAggregate {
  private root: User;
  private domainEvents: DomainEvent[] = [];

  performBusinessOperation() {
    // LÃ³gica de negÃ³cio do agregado
    this.addDomainEvent(new UserBusinessOperationPerformedEvent(this.root.id));
  }
}
```

### Clean Architecture
- **Domain Layer**: 100% independente de frameworks
- **Application Layer**: Coordena domÃ­nio e infraestrutura
- **Infrastructure Layer**: Detalhes tÃ©cnicos isolados
- **Presentation Layer**: Interface externa

## ğŸ§ª Testes Gerados

O generator cria testes abrangentes:

```typescript
describe('User Domain', () => {
  it('should create valid entity', () => {
    expect(entity.isValid()).toBe(true);
  });
});

describe('User Application Service', () => {
  it('should create entity', async () => {
    // Testes de aplicaÃ§Ã£o
  });
});

describe('User Controller', () => {
  it('should get entity by id', async () => {
    // Testes de apresentaÃ§Ã£o
  });
});
```

## âš™ï¸ ConfiguraÃ§Ãµes

### OpÃ§Ãµes do Generator

```typescript
interface DDDGenerationOptions {
  modulesPath?: string;      // Caminho dos mÃ³dulos (padrÃ£o: 'src/modules')
  domainPath?: string;       // Caminho do domÃ­nio (padrÃ£o: 'src/domain')
  force?: boolean;           // ForÃ§ar regeraÃ§Ã£o (padrÃ£o: false)
  verbose?: boolean;         // Log detalhado (padrÃ£o: true)
  dryRun?: boolean;          // Apenas simular (padrÃ£o: false)
  boundedContext?: string;   // Contexto delimitado (padrÃ£o: 'default')
}
```

### VariÃ¡veis de Ambiente

```bash
# ConfiguraÃ§Ãµes de banco
DB_HOST=localhost
DB_PORT=5432
DB_NAME=app_db
DB_USER=user
DB_PASSWORD=password

# ConfiguraÃ§Ãµes de serviÃ§os externos
EXTERNAL_SERVICE_URL=https://api.external.com
EXTERNAL_API_KEY=your-api-key
EXTERNAL_TIMEOUT=5000

# JWT
JWT_SECRET=your-jwt-secret
```

## ğŸ‰ BenefÃ­cios

- **ğŸ—ï¸ Arquitetura Completa**: 4 camadas DDD prontas para produÃ§Ã£o
- **ğŸ”„ CQRS**: SeparaÃ§Ã£o clara entre comandos e queries
- **ğŸ§ª Testabilidade**: Cada camada isolada e testÃ¡vel
- **ğŸ”§ Manutenibilidade**: MudanÃ§as no domÃ­nio nÃ£o afetam infraestrutura
- **ğŸ“ˆ Escalabilidade**: Bounded contexts independentes
- **ğŸ’¬ Ubiquitous Language**: CÃ³digo reflete conceitos do negÃ³cio

## ğŸ“š PrÃ³ximos Passos

1. Execute o exemplo: `bun run examples/test-ddd-generator.ts`
2. Explore os arquivos gerados em `src/modules/user/`
3. Customize os schemas Zod conforme suas necessidades
4. Adapte as configuraÃ§Ãµes de banco e serviÃ§os externos
5. Implemente os repositÃ³rios concretos para seu banco de dados
6. Configure as rotas no seu framework web

---

**ğŸ¯ O AutoGeneratorDDD transforma schemas Zod simples em arquiteturas DDD completas e production-ready!**
