/**
 * Execu√ß√£o Manual do AutoGeneratorDDD
 * Este arquivo mostra exatamente como executar o gerador passo a passo
 */

console.log('üîç DEBUG: Iniciando arquivo manual-execution.ts');

let autoGenerateDDDFromZodSchemas, AutoGeneratorDDD;

try {
  console.log('üì¶ DEBUG: Tentando importar auto-generator-ddd...');
  const module = await import('../src/auto-generator-ddd.js');
  autoGenerateDDDFromZodSchemas = module.autoGenerateDDDFromZodSchemas;
  AutoGeneratorDDD = module.AutoGeneratorDDD;
  console.log('‚úÖ DEBUG: Importa√ß√£o bem-sucedida!');
} catch (importError) {
  console.error('‚ùå DEBUG: Erro na importa√ß√£o:', importError);
  console.error('‚ùå DEBUG: Stack trace:', importError.stack);
  process.exit(1);
}

// =========================================
// M√âTODO 1: Usando a fun√ß√£o utilit√°ria
// =========================================

export async function executarGeradorSimples() {
  console.log('üöÄ Executando via fun√ß√£o utilit√°ria...\n');

  await autoGenerateDDDFromZodSchemas({
    modulesPath: 'examples',           // ‚Üê Procura schemas aqui
    domainPath: 'src/domain',          // ‚Üê Gera dom√≠nio aqui
    boundedContext: 'user',            // ‚Üê Nome do contexto
    verbose: true,                     // ‚Üê Log detalhado
    force: true,                       // ‚Üê Sobrescrever arquivos
    dryRun: true                       // ‚Üê Apenas simular (mude para false)
  });

  console.log('‚úÖ Fun√ß√£o utilit√°ria executada!');
}

// =========================================
// M√âTODO 2: Usando a classe diretamente
// =========================================

export async function executarGeradorClasse() {
  console.log('üöÄ Executando via classe...\n');

  const generator = new AutoGeneratorDDD({
    modulesPath: 'examples',
    domainPath: 'src/domain',
    boundedContext: 'user',
    verbose: true,
    force: true,
    dryRun: true
  });

  await generator.generate();

  console.log('‚úÖ Classe executada!');
}

// =========================================
// M√âTODO 3: Execu√ß√£o passo a passo
// =========================================

export async function executarPassoAPasso() {
  console.log('üöÄ Executando passo a passo...\n');

  console.log('üìÇ Etapa 1: Criando inst√¢ncia do gerador...');
  const generator = new AutoGeneratorDDD({
    modulesPath: 'examples',
    domainPath: 'src/domain',
    boundedContext: 'user',
    verbose: true,
    force: true,
    dryRun: true
  });

  console.log('üîç Etapa 2: Procurando schemas Zod...');
  // O generate() faz automaticamente

  console.log('üèóÔ∏è  Etapa 3: Gerando estrutura DDD...');
  await generator.generate();

  console.log('üìä Etapa 4: Verificando m√≥dulos gerados...');
  const modulos = AutoGeneratorDDD.listGeneratedDDDModules('examples');
  console.log(`üì¶ M√≥dulos encontrados: ${modulos.join(', ')}`);

  console.log('‚úÖ Execu√ß√£o passo a passo conclu√≠da!');
}

// =========================================
// FUN√á√ÉO PRINCIPAL PARA EXECU√á√ÉO MANUAL
// =========================================

export async function executarManual() {
  console.log('üéØ EXECU√á√ÉO MANUAL DO AUTOGENERATORDDD');
  console.log('======================================\n');

  try {
    console.log('üîß DEBUG: Tentando executar executarGeradorClasse()...');

    await executarGeradorClasse();       // M√©todo 2 - Classe

    console.log('\nüéâ Execu√ß√£o manual conclu√≠da com sucesso!');
    console.log('\nüìã PR√ìXIMOS PASSOS:');
    console.log('1. Verifique os arquivos em examples/user/');
    console.log('2. Verifique os arquivos em src/domain/user-example/');
    console.log('3. Mude dryRun: false para gerar arquivos reais');
    console.log('4. Execute: npx tsx examples/manual-execution.ts');

  } catch (error) {
    console.error('\n‚ùå Erro na execu√ß√£o manual:', error);
    console.error('\nüîß POSS√çVEIS SOLU√á√ïES:');
    console.log('1. Verifique se examples/user.schema.ts existe');
    console.log('2. Verifique se src/auto-generator-ddd.ts compila');
    console.log('3. Execute: npx tsc --noEmit src/auto-generator-ddd.ts');
    console.error('\nüìã Stack trace completo:', error.stack);
  }
}

// =========================================
// EXECU√á√ÉO AUTOM√ÅTICA
// =========================================

// Executar automaticamente quando o arquivo for chamado diretamente
if (import.meta.url === `file://${process.argv[1]}`) {
  executarManual().catch(console.error);
}
